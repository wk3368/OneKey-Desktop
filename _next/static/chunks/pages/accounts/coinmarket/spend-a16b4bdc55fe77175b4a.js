_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[37],{XUUr:function(e,t,n){"use strict";n.r(t);var o=n("cxan"),r=n("zjfJ"),i=n("ERkP"),a=n.n(i),s=n("9+6G"),d=n("4Vpd"),l=n("j/s1"),c=n("nRYI"),p=n("r1NI"),u=n("BUnG"),f=n("e3wq"),v=n("uDP8"),w=n("hxOz"),y=n("ZVkw"),g=n("yXEX"),b=n("XLN4"),m=n("Rm8+"),O=n("QO0o");function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const j=Object(i.createContext)(null);j.displayName="CoinmarketSpendContext";var N=a.a.createElement;const S=l.default.div.withConfig({displayName:"Spend__Wrapper"})(["display:flex;flex-direction:column;flex:1;@media screen and (max-width:","){padding:0;}"],c.variables.SCREEN_SIZE.LG),C=l.default.div.withConfig({displayName:"Spend__Loading"})(["display:flex;font-size:",";"],c.variables.FONT_SIZE.BIG),E=l.default.div.withConfig({displayName:"Spend__NoProviders"})(["display:flex;font-size:",";"],c.variables.FONT_SIZE.BIG),P=l.default.div.withConfig({displayName:"Spend__Vouchers"})([""]),x=l.default.div.withConfig({displayName:"Spend__ProviderInfo"})(["display:flex;align-items:center;margin-bottom:15px;color:",";"],(e=>e.theme.TYPE_LIGHT_GREY)),I=Object(l.default)(c.Icon).withConfig({displayName:"Spend__StyledIcon"})(["padding-right:4px;"]),T=l.default.div.withConfig({displayName:"Spend__IframeWrapper"})(["min-height:500px;display:flex;align-items:center;justify-content:center;border:1px solid ",";"],(e=>e.theme.STROKE_GREY)),k=l.default.div.withConfig({displayName:"Spend__WebContent"})(["display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:150px;"]),R=l.default.div.withConfig({displayName:"Spend__IframeContent"})([""]),A=l.default.div.withConfig({displayName:"Spend__WebInfo"})(["display:flex;justify-content:center;"]),D=Object(l.default)(c.Button).withConfig({displayName:"Spend__StyledButton"})(["margin-top:25px;"]),L=l.default.div.withConfig({displayName:"Spend__Left"})(["padding-right:5px;display:flex;"]),U=l.default.div.withConfig({displayName:"Spend__Right"})([""]);var V=()=>{const{isLoading:e,noProviders:t,voucherSiteUrl:n,openWindow:o,setShowLeaveModal:r}=(()=>{const e=Object(i.useContext)(j);if(null===e)throw Error("SpendContext used without Context");return e})(),a=!Object(u.k)();return N(S,null,e&&N(C,null,N(p.J,{id:"TR_SPEND_LOADING"})),!e&&t&&N(E,null,N(p.J,{id:"TR_SPEND_NO_PROVIDERS"})),!e&&!t&&N(P,null,a&&N(R,null,N(x,null,N(L,null,N(I,{icon:"INFO"})),N(U,null,N(p.J,{id:"TR_SPEND_PROVIDER_CONTENT"}))),N(T,null,N("iframe",{title:".",sandbox:"allow-scripts allow-forms allow-same-origin",style:{width:"100%",height:"650px",border:"0",display:"block"},src:n}))),!a&&N(k,null,N(A,null,N(L,null,N(I,{icon:"INFO"})),N(U,null,N(p.J,{id:"TR_SPEND_PROVIDER_CONTENT_WINDOW"}))),N(D,{variant:"primary",onClick:()=>{r(!0),o(n)}},N(p.J,{id:"TR_SPEND_OPEN_WINDOW"})))))},W=a.a.createElement;function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const J=e=>{const{selectedAccount:t}=e,n=(e=>{var t,n;const{sellInfo:o}=Object(f.b)(),{0:r,1:a}=Object(i.useState)("error"),{composeTransaction:s,saveComposedTransaction:l,signTransaction:c,addNotification:p,setShowLeaveModal:_}=Object(d.b)({composeTransaction:g.a,saveComposedTransaction:g.c,signTransaction:g.e,addNotification:m.b,setShowLeaveModal:b.c}),{translationString:j}=Object(y.a)(),{selectedAccount:N,language:S,fees:C}=e,{account:E,network:P}=N,x=null===o||void 0===o||null===(t=o.sellList)||void 0===t?void 0:t.country,I=!o||!r,T=null===o||void 0===o||null===(n=o.sellList)||void 0===n?void 0:n.providers.filter((e=>"Voucher"===e.type))[0],k=!T||!T.tradedCoins.includes(E.symbol.toUpperCase())||!r||"error"===r;Object(i.useEffect)((()=>{T&&(T.tradedCoins.includes(E.symbol.toUpperCase())?(a(void 0),v.a.getVoucherQuotes({country:x,cryptoCurrency:E.symbol.toUpperCase(),language:S,refundAddress:Object(w.c)(E).address}).then((e=>{if(e.length>0){const t=e[0];void 0===t.error?a(t.siteUrl):a("error")}}))):a("error"))}),[E,x,S,T]);const R=Object(i.useCallback)((async e=>{if(e.cryptoAmount&&e.destinationAddress&&!e.error){let t;const n="normal",o=C[E.symbol],r=Object(O.i)(E.networkType,o),i=h(h({},o),{},{levels:r}),a=i.levels.find((e=>e.label===n));if(!a)return!1;const d=await s({account:E,amount:e.cryptoAmount.toString(),feeInfo:i,feePerUnit:a.feePerUnit,selectedFee:n,feeLimit:a.feeLimit||"0",network:P,isMaxActive:!1,address:e.destinationAddress,isInvity:!0}),u=d?d[a.label]:null;if("final"===(null===u||void 0===u?void 0:u.type))return l(u),void(await c({account:E,address:e.destinationAddress,destinationTag:void 0,transactionInfo:u,network:P,amount:u.totalSpent})&&(await v.a.confirmVoucherTrade(e),_(!1)));"error"===(null===u||void 0===u?void 0:u.type)&&u.errorMessage&&(t=j(u.errorMessage.id,u.errorMessage.values)),t||(t="Cannot create transaction"),p({type:"error",error:t})}}),[E,p,s,C,P,l,_,c,j]);return Object(i.useEffect)((()=>{if(!I&&!k){const t=async e=>{if(T&&T.voucherSiteOrigin===e.origin){const n=await v.a.requestVoucherTrade({exchange:T.name,cryptoCurrency:E.symbol.toUpperCase(),data:e.data});var t;n.error&&p({type:"error",error:n.error}),"SEND_CRYPTO"!==n.status||n.error||(R(n),null===(t=window.desktopApi)||void 0===t||t.windowFocus())}};var e;return Object(u.k)()?(null===(e=window.desktopApi)||void 0===e||e.on("spend/message",t),()=>{var e;null===(e=window.desktopApi)||void 0===e||e.removeAllListeners("spend/message")}):(window.addEventListener("message",t),()=>{window.removeEventListener("message",t)})}}),[E.symbol,I,k,T,R,p]),{openWindow:async e=>{var t,n;const o=await(null===(t=window.desktopApi)||void 0===t?void 0:t.getHttpReceiverAddress("/spend-iframe")),r=await(null===(n=window.desktopApi)||void 0===n?void 0:n.getHttpReceiverAddress("/spend-handle-message"));if(e&&r){const t=`${o}?voucherSiteUrl=${encodeURIComponent(e)}&handleMessageEndpoint=${encodeURIComponent(r)}`;window.open(t,"_blank")}},account:E,isLoading:I,noProviders:k,network:P,provider:T,voucherSiteUrl:r,setShowLeaveModal:_}})(M(M({},e),{},{selectedAccount:t}));return W(s.k,null,W(j.Provider,{value:n},W(V,null)))};var X=()=>{const e=Object(d.k)((e=>({selectedAccount:e.wallet.selectedAccount,device:e.suite.device,language:e.suite.settings.language,fees:e.wallet.fees}))),{selectedAccount:t}=e;return"loaded"!==t.status?W(s.s,{title:"TR_NAV_SPEND",account:t}):W(J,Object(o.a)({},e,{selectedAccount:t}))};t.default=X},bCxx:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/accounts/coinmarket/spend",function(){return n("XUUr")}])}},[["bCxx",0,1,7,13,10,3,15,8,11,9,14,6,12,5,16,2,4,17]]]);
//# sourceMappingURL=spend-a16b4bdc55fe77175b4a.js.map