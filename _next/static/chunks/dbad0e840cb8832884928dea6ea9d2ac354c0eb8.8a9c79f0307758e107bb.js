(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[17],{yXEX:function(e,t,n){"use strict";n.d(t,"f",(function(){return S})),n.d(t,"c",(function(){return N})),n.d(t,"d",(function(){return A})),n.d(t,"a",(function(){return D})),n.d(t,"e",(function(){return M})),n.d(t,"b",(function(){return R}));var r=n("zjfJ"),o=n("kUQw"),s=n.n(o),a=n("eCku"),c=n("vM3x"),i=n.n(c),u=n("8jse"),p=n("Rm8+"),d=n("hxOz");const l=({account:e,network:t,address:n,amount:r,token:o,isMaxActive:s,isInvity:c})=>{var i;const u=c?Object(d.d)(o):o,p=null===(i=e.tokens)||void 0===i?void 0:i.find((e=>e.symbol===u)),l=p?p.decimals:t.decimals,f=Object(a.b)(r,l);let y;return y=s?n?{type:"send-max",address:n}:{type:"send-max-noaddress"}:n?{type:"external",address:n,amount:f}:{type:"noaddress",amount:f},{output:y,tokenInfo:p,decimals:l}};var f=n("aQMI");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const b=e=>async t=>{const{account:n,feeInfo:r}=e;if(!n.addresses||!n.utxo)return;const o=(({account:e,address:t,amount:n,isMaxActive:r})=>{const o=[];if(r)t?o.push({type:"send-max",address:t}):o.push({type:"send-max-noaddress"});else if(n){const r=Object(a.z)(n,e.symbol);t?o.push({type:"external",address:t,amount:r}):o.push({type:"noaddress",amount:r})}return o})(e);if(o.length<1)return;const c=r.levels.filter((e=>"custom"!==e.label));"custom"===e.selectedFee&&c.push({label:"custom",feePerUnit:e.feePerUnit,blocks:-1});const u={account:{path:n.path,addresses:n.addresses,utxo:n.utxo.filter((e=>"0"!==e.amount))},feeLevels:c,outputs:o,coin:n.symbol},d=await s.a.composeTransaction(m(m({},u),{},{account:u.account}));if(!d.success)return void t(p.b({type:"sign-tx-error",error:d.payload.error}));const l={};d.payload.forEach(((e,t)=>{const n=c[t].label;l[n]=e}));if(!d.payload.find((e=>"error"!==e.type))&&!l.custom){const{minFee:e}=r,t=c[c.length-1].feePerUnit,n=new i.a(t).minus(e).gt(1e3)?1e3:1;let o=new i.a(t).minus(n);const a=[];for(;o.gte(e);)a.push({feePerUnit:o.toString(),label:"custom",blocks:-1}),o=o.minus(n);const p=a.length>0?await s.a.composeTransaction(m(m({},u),{},{account:u.account,feeLevels:a})):{success:!1};if(p.success){const e=p.payload.findIndex((e=>"error"!==e.type));e>=0&&(l.custom=p.payload[e])}}return Object.keys(l).forEach((e=>{const r=l[e];"error"!==r.type?(r.feePerByte=new i.a(r.feePerByte).integerValue(i.a.ROUND_FLOOR).toString(),"string"===typeof r.max&&(r.max=Object(a.h)(r.max,n.symbol))):"NOT-ENOUGH-FUNDS"===r.error?r.errorMessage={id:"AMOUNT_IS_NOT_ENOUGH"}:t(p.b({type:"sign-tx-error",error:r.error}))})),l},O=(e,t)=>{let n=0;const r=t.map((t=>{const r=m({},t);return t.address&&(n++,r.address=e),r}));if(1===n)return r};var g=n("LsHn"),h=n("QO0o"),w=n("nhJV");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const P=(e,t,n,r)=>{const o=Object(h.a)(Object(g.toWei)(n.feePerUnit,"gwei"),n.feeLimit||"0");let s,c;const u=r?Object(a.b)(r.balance,r.decimals):void 0;"send-max"===t.type||"send-max-noaddress"===t.type?(c=u||Object(h.b)(e,o),s=c):s=t.amount;const p=new i.a(Object(h.c)(r?"0":s,o));if(p.isGreaterThan(e)){const e=r?"AMOUNT_NOT_ENOUGH_CURRENCY_FEE":"AMOUNT_IS_NOT_ENOUGH";return{type:"error",error:e,errorMessage:{id:e}}}if(u&&("0"===u||new i.a(s).gt(u)))return{type:"error",error:"AMOUNT_IS_NOT_ENOUGH",errorMessage:{id:"AMOUNT_IS_NOT_ENOUGH"}};const d={type:"nonfinal",totalSpent:r?s:p.toString(),max:c,fee:o,feePerByte:n.feePerUnit,feeLimit:n.feeLimit,token:r,bytes:0};return"send-max"===t.type||"external"===t.type?j(j({},d),{},{type:"final",transaction:{inputs:[],outputs:[{address:t.address,amount:s,script_type:"PAYTOADDRESS"}]}}):d};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const E=(e,t,n)=>{const r=n.feePerUnit;let o,s;"send-max"===t.type||"send-max-noaddress"===t.type?(s=Object(h.b)(e,r),o=s):o=t.amount;const a=new i.a(Object(h.c)(o,r));if(a.isGreaterThan(e))return{type:"error",error:"AMOUNT_IS_NOT_ENOUGH",errorMessage:{id:"AMOUNT_IS_NOT_ENOUGH"}};const c={type:"nonfinal",totalSpent:a.toString(),max:s,fee:r,feePerByte:n.feePerUnit,bytes:0};return"send-max"===t.type||"external"===t.type?T(T({},c),{},{type:"final",transaction:{inputs:[],outputs:[{address:t.address,amount:o,script_type:"PAYTOADDRESS"}]}}):c};var I=n("Tdcs"),U=n("FPY2");function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const S=(e,t=!1)=>async(n,r)=>{const{device:a}=r().suite;if(!a||!e)return;const{path:c,address:i}=Object(d.c)(e);if(!c||!i)return;const{networkType:u,symbol:l}=e,{useEmptyPassphrase:f,connected:y,available:m}=a,b={device:a,address:i,networkType:u,symbol:l,addressPath:c};if(!y||!m)return void n(I.openModal(_({type:"unverified-address"},b)));const O={device:a,path:c,useEmptyPassphrase:f,coin:e.symbol},g=e=>{e&&"ButtonRequest_Address"===e.code&&n(I.openModal(_({type:"address"},b)))};let h;switch(u){case"ethereum":h=s.a.ethereumGetAddress;break;case"ripple":h=s.a.rippleGetAddress;break;case"bitcoin":h=s.a.getAddress;break;default:h=()=>({success:!1,payload:{error:"Method for getAddress not defined",code:void 0}})}s.a.on(o.UI.REQUEST_BUTTON,g);const w=await h(O);if(s.a.off(o.UI.REQUEST_BUTTON,g),w.success)n({type:t?U.f.VERIFY_ADDRESS:U.d.VERIFY_ADDRESS,addressVerified:i});else{if("Method_PermissionsNotGranted"===w.payload.code)return;n(p.b({type:"verify-address-error",error:w.payload.error}))}},N=e=>({type:U.e.SAVE_COMPOSED_TRANSACTION,composedTransaction:e}),A=e=>({type:U.e.SAVE_TRANSACTION_REVIEW,reviewData:e}),D=e=>t=>{const{account:{networkType:n}}=e;return"bitcoin"===n?t(b(e)):"ethereum"===n?t((e=>async()=>{const{account:t,network:n,feeInfo:r,address:o,amount:c,ethereumDataHex:u}=e,p=l(e);if(!p)return;const{output:d,tokenInfo:y,decimals:m}=p,{availableBalance:b}=t;let O;y&&(O=f.g);const g=await s.a.blockchainEstimateFee({coin:t.symbol,request:{blocks:[2],specific:j({from:t.descriptor},Object(h.g)(o||t.descriptor,y,c,u))}});g.success&&(O=g.payload.levels[0].feeLimit);const w=(O?r.levels.map((e=>j({},e))):r.levels).filter((e=>"custom"!==e.label));O&&w.forEach((e=>e.feeLimit=O)),"custom"===e.selectedFee&&w.push({label:"custom",feePerUnit:e.feePerUnit,feeLimit:e.feeLimit,blocks:-1});const v={},x=w.map((e=>P(b,d,e,y)));if(x.forEach(((e,t)=>{const n=w[t].label;v[n]=e})),!x.find((e=>"error"!==e.type))&&!v.custom){const{minFee:e}=r,t=w[w.length-1].feePerUnit;let n=new i.a(t).minus(1);const o=[];for(;n.gte(e);)o.push({feePerUnit:n.toString(),feeLimit:w[0].feeLimit,label:"custom",blocks:-1}),n=n.minus(1);const s=o.map((e=>P(b,d,e,y))),a=s.findIndex((e=>"error"!==e.type));a>=0&&(v.custom=s[a])}return Object.keys(v).forEach((e=>{const t=v[e];"error"!==t.type&&(t.max=t.max?Object(a.g)(t.max,m):void 0,t.estimatedFeeLimit=O),"error"===t.type&&"AMOUNT_NOT_ENOUGH_CURRENCY_FEE"===t.error&&(t.errorMessage={id:"AMOUNT_NOT_ENOUGH_CURRENCY_FEE",values:{symbol:n.symbol.toUpperCase()}})})),v})(e)):"ripple"===n?t((e=>()=>{const{account:t,feeInfo:n}=e,r=l(e);if(!r)return;const{output:o}=r,{availableBalance:s}=t,c=n.levels.filter((e=>"custom"!==e.label));"custom"===e.selectedFee&&c.push({label:"custom",feePerUnit:e.feePerUnit,blocks:-1});const u={},p=c.map((e=>E(s,o,e)));if(p.forEach(((e,t)=>{const n=c[t].label;u[n]=e})),!p.find((e=>"error"!==e.type))&&!u.custom){const{minFee:e}=n,t=c[c.length-1].feePerUnit;let r=new i.a(t).minus(1);const a=[];for(;r.gte(e);)a.push({feePerUnit:r.toString(),label:"custom",blocks:-1}),r=r.minus(1);const p=a.map((e=>E(s,o,e))),d=p.findIndex((e=>"error"!==e.type));d>=0&&(u.custom=p[d])}return Object.keys(u).forEach((e=>{const n=u[e];"error"!==n.type&&n.max&&(n.max=Object(a.h)(n.max,t.symbol))})),u})(e)):void 0},M=e=>async t=>{var n,r;const{account:o}=e;if(!o)return;let c;var u;if("bitcoin"===o.networkType&&(c=await t((u=e,async(e,t)=>{const{selectedAccount:n}=t().wallet,{device:r}=t().suite,{transactionInfo:o,address:a}=u;if("loaded"!==n.status||!r||!o)return;const{account:c}=n,{transaction:i}=o;let d={};"zec"===c.symbol&&(d=f.l);const l=O(a,i.outputs);if(!l)return void e(p.b({type:"sign-tx-error",error:"Invalid transaction outputs"}));const y=i.inputs.map((e=>m({},e))).filter((e=>"0"!==e.amount));y.forEach((e=>{e.sequence||delete e.sequence}));const b=m({device:{path:r.path,instance:r.instance,state:r.state},useEmptyPassphrase:r.useEmptyPassphrase,outputs:l,inputs:y,coin:c.symbol},d),g={signedTx:void 0,transactionInfo:m(m({},o),{},{transaction:m(m({},i),{},{inputs:y,outputs:l})})};e(A(g));const h=await s.a.signTransaction(b);if(h.success)return m(m({},g),{},{signedTx:{tx:h.payload.serializedTx,coin:c.symbol}});"tx-cancelled"!==h.payload.error&&e(p.b({type:"sign-tx-error",error:h.payload.error}))}))),"ethereum"===o.networkType&&(c=await t((e=>async(t,n)=>{const{selectedAccount:r,transactions:o}=n().wallet,{device:c}=n().suite;if("loaded"!==r.status||!c||!e.transactionInfo)return;const{account:u}=r;if("ethereum"!==u.networkType||!e.network.chainId)return;const d=(o.transactions[u.key]||[]).filter(w.m).reduce(((e,t)=>t.ethereumSpecific?Math.max(e,t.ethereumSpecific.nonce+1):e),0),l=new i.a(d),y=l.gt(0)&&l.gt(u.misc.nonce)?l.toString():u.misc.nonce,m=O(e.address,e.transactionInfo.transaction.outputs);if(!m)return void t(p.b({type:"sign-tx-error",error:"Invalid transaction outputs"}));const b=e.transactionInfo.token?e.transactionInfo.token.decimals:e.network.decimals,g=Object(h.n)({token:e.transactionInfo.token,chainId:e.network.chainId,to:e.address,amount:Object(a.g)(e.transactionInfo.transaction.outputs[0].amount,b),gasLimit:e.transactionInfo.feeLimit||f.i,gasPrice:e.transactionInfo.feePerByte,nonce:y}),v={signedTx:void 0,transactionInfo:j(j({},e.transactionInfo),{},{transaction:j(j({},e.transactionInfo.transaction),{},{outputs:m})})};await t(A(v));const P=await s.a.ethereumSignTransaction({device:{path:c.path,instance:c.instance,state:c.state},useEmptyPassphrase:c.useEmptyPassphrase,path:u.path,transaction:g});if(P.success)return j(j({},v),{},{signedTx:{tx:Object(h.o)(j(j({},g),P.payload)),coin:u.symbol}});"tx-cancelled"!==P.payload.error&&t(p.b({type:"sign-tx-error",error:P.payload.error}))})(e))),"ripple"===o.networkType&&(c=await t((e=>async(t,n)=>{const{selectedAccount:r}=n().wallet,{device:o}=n().suite;if("loaded"!==r.status||!o||!e.transactionInfo)return;const{account:a}=r;if("ripple"!==a.networkType)return;const c=O(e.address,e.transactionInfo.transaction.outputs);if(!c)return void t(p.b({type:"sign-tx-error",error:"Invalid transaction outputs"}));const i={destination:e.address,amount:e.transactionInfo.transaction.outputs[0].amount};e.destinationTag&&(i.destinationTag=parseInt(e.destinationTag,10));const u={signedTx:void 0,transactionInfo:T(T({},e.transactionInfo),{},{transaction:T(T({},e.transactionInfo.transaction),{},{outputs:c})}),extraFields:{destinationTag:e.destinationTag||void 0}};t(A(u));const d=await s.a.rippleSignTransaction({device:{path:o.path,instance:o.instance,state:o.state},useEmptyPassphrase:o.useEmptyPassphrase,path:a.path,transaction:{fee:e.transactionInfo.feePerByte,flags:f.k,sequence:a.misc.sequence,payment:i}});if(d.success)return T(T({},u),{},{signedTx:{tx:d.payload.serializedTx,coin:a.symbol}});"tx-cancelled"!==d.payload.error&&t(p.b({type:"sign-tx-error",error:d.payload.error}))})(e))),null===(n=c)||void 0===n||null===(r=n.signedTx)||void 0===r||!r.tx)return;await t(A(c));return await t(I.openDeferredModal({type:"coinmarket-review-transaction"}))&&c.transactionInfo?t(R(c)):void 0},R=e=>async(t,n)=>{const{account:r}=n().wallet.selectedAccount,{device:o}=n().suite,{signedTx:c,transactionInfo:d}=e;if(!c||!d||!r)return!1;const l=await s.a.pushTransaction(c);t((e=>t=>{e?t(I.onCancel()):s.a.cancel("tx-cancelled")})(c));const{token:f}=d,y=f?"0":new i.a(d.totalSpent).minus(d.fee).toString(),m=f?`${Object(a.g)(d.totalSpent,f.decimals)} ${f.symbol.toUpperCase()}`:Object(a.h)(y,r.symbol,!0);return l.success?(t(p.b({type:"tx-sent",formattedAmount:m,device:o,descriptor:r.descriptor,symbol:r.symbol,txid:l.payload.txid})),t(u.d(r))):t(p.b({type:"sign-tx-error",error:l.payload.error})),l.success}}}]);
//# sourceMappingURL=dbad0e840cb8832884928dea6ea9d2ac354c0eb8.8a9c79f0307758e107bb.js.map